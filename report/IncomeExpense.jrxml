<?xml version="1.0"?>
<!DOCTYPE jasperReport PUBLIC "-//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">

<jasperReport
	      name="CashFlow"
	      pageWidth="595"
	      pageHeight="842"
	      columnWidth="515"
	      columnSpacing="0"
	      leftMargin="40"
	      rightMargin="40"
	      topMargin="170"
	      bottomMargin="100">

  <reportFont name="plain" isDefault="true"/>
  <reportFont name="bold" isBold="true" pdfFontName="Helvetica-Bold"/>
  <reportFont name="italic" isItalic="true" pdfFontName="Helvetica-Oblique"/>

  <parameter name="Title" class="java.lang.String"/>
  <parameter name="Subtitle" class="java.lang.String"/>

  <parameter name="Total" class="java.lang.String"/>
  <parameter name="Category" class="java.lang.String"/>
  <parameter name="Income" class="java.lang.String"/>
  <parameter name="Expense" class="java.lang.String"/>

  <parameter name="DateToday" class="java.lang.String"/>
  <parameter name="Page" class="java.lang.String"/>
  
  <parameter name="Dashline" class="java.lang.String"/>
  <parameter name="President" class="java.lang.String"/>
  <parameter name="Auditor" class="java.lang.String"/>
  <parameter name="Treasurer" class="java.lang.String"/>

  <field name="currencyCode" class="java.lang.String"/>
  <field name="baseCategory" class="java.lang.String"/>
  <field name="category" class="java.lang.String"/>
  <field name="income" class="java.lang.Long"/>
  <field name="incomeString" class="java.lang.String"/>
  <field name="expense" class="java.lang.Long"/>
  <field name="expenseString" class="java.lang.String"/>

  <variable name="CurrencyIncome" class="java.lang.Long" resetType="Group" resetGroup="CurrencyGroup" calculation="Sum">
    <variableExpression>$F{income}</variableExpression>
    <initialValueExpression>new Long(0)</initialValueExpression>
  </variable>

  <variable name="CurrencyExpense" class="java.lang.Long" resetType="Group" resetGroup="CurrencyGroup" calculation="Sum">
    <variableExpression>$F{expense}</variableExpression>
    <initialValueExpression>new Long(0)</initialValueExpression>
  </variable>
  
  <variable name="CurrencyIncomeFinal" class="java.lang.Long" resetType="Group" resetGroup="CurrencyGroup" calculation="Nothing">
    <variableExpression>$V{CurrencyIncome} == null ? 0 : $V{CurrencyIncome}</variableExpression>
  </variable>
  
  <variable name="CurrencyExpenseFinal" class="java.lang.Long" resetType="Group" resetGroup="CurrencyGroup" calculation="Nothing">
    <variableExpression>$V{CurrencyExpense} == null ? 0 : $V{CurrencyExpense}</variableExpression>
  </variable>
  
	<variable name="TotalPages" class="java.lang.Integer" resetType="Page">
	<variableExpression>$V{PAGE_NUMBER}</variableExpression>
	<initialValueExpression>new Integer(0)</initialValueExpression>
</variable>

  <group name="CurrencyGroup">
    <groupExpression>
      $F{currencyCode}
    </groupExpression>

    <groupHeader>
      <band height="0">
      </band>
    </groupHeader>

    <groupFooter>
      <band height="50">
	<line>
	  <reportElement x="0" y="0" width="515" height="0"/>
	  <graphicElement/>
	</line>

	<textField>
	  <reportElement x="0" y="5" width="310" height="13"/>
	  <textElement>
	    <font reportFont="bold"/>
	  </textElement>
	  <textFieldExpression class="java.lang.String">
	    $P{Total} + " " + $F{currencyCode}
	  </textFieldExpression>
	</textField>

	<textField>
	  <reportElement x="320" y="5" width="95" height="13"/>
	  <textElement textAlignment="Right">
	    <font reportFont="bold"/>
	  </textElement>
	  <textFieldExpression class="java.lang.String">
	    net.sf.jmoney.Currency.getCurrencyForCode($F{currencyCode}).format($V{CurrencyIncomeFinal}.longValue())
	  </textFieldExpression>
	</textField>

	<textField>
	  <reportElement x="420" y="5" width="95" height="13"/>
	  <textElement textAlignment="Right">
	    <font reportFont="bold"/>
	  </textElement>
	  <textFieldExpression class="java.lang.String">
	    net.sf.jmoney.Currency.getCurrencyForCode($F{currencyCode}).format($V{CurrencyExpenseFinal}.longValue())
	  </textFieldExpression>
	</textField>

	<textField>
	  <reportElement x="0" y="20" width="310" height="13"/>
	  <textElement>
	    <font reportFont="bold"/>
	  </textElement>
	  <textFieldExpression class="java.lang.String">
	    $P{Income} + " - " + $P{Expense}
	  </textFieldExpression>
	</textField>

	<textField>
	  <reportElement x="420" y="20" width="95" height="13"/>
	  <textElement textAlignment="Right">
	    <font reportFont="bold"/>
	  </textElement>
	  <textFieldExpression class="java.lang.String">
	    net.sf.jmoney.Currency.getCurrencyForCode($F{currencyCode}).format(
	      $V{CurrencyIncomeFinal}.longValue() -
	      $V{CurrencyExpenseFinal}.longValue())
	  </textFieldExpression>
	</textField>

	<line>
	  <reportElement x="0" y="37" width="515" height="0"/>
	  <graphicElement/>
	</line>
      </band>
    </groupFooter>
  </group>

  <title>
	<band height="50">
		<textField>
			<reportElement x="0" y="0" width="515" height="16" />
			<textElement textAlignment="Center">
				<font reportFont="bold" size="12" />
			</textElement>
			<textFieldExpression class="java.lang.String">
				$P{Title}
			</textFieldExpression>
		</textField>

		<textField>
			<reportElement x="0" y="17" width="515" height="13" />
			<textElement textAlignment="Center" />
			<textFieldExpression class="java.lang.String">
				$P{Subtitle}
			</textFieldExpression>
		</textField>
	</band>
</title>

  <pageHeader>
    <band height="17">
      <textField>
	<reportElement x="0" y="0" width="315" height="13"/>
	<textElement>
	  <font reportFont="bold"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $P{Category}
	</textFieldExpression>
      </textField>

      <textField>
	<reportElement x="320" y="0" width="95" height="13"/>
	<textElement textAlignment="Right">
	  <font reportFont="bold"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $P{Income}
	</textFieldExpression>
      </textField>

      <textField>
	<reportElement x="420" y="0" width="95" height="13"/>
	<textElement textAlignment="Right">
	  <font reportFont="bold"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $P{Expense}
	</textFieldExpression>
      </textField>

      <line>
	<reportElement x="0" y="12" width="515" height="0"/>
	<graphicElement/>
      </line>
    </band>
  </pageHeader>

  <columnHeader>
    <band height="0"/>
  </columnHeader>

  <detail>
    <band height="17">
      <textField>
	<reportElement x="0" y="0" width="315" height="13"/>
	<textFieldExpression class="java.lang.String">
	  $F{category}
	</textFieldExpression>
      </textField>

      <textField>
	<reportElement x="320" y="0" width="95" height="13"/>
	<textElement textAlignment="Right"/>
	<textFieldExpression class="java.lang.String">
	  $F{incomeString}
	</textFieldExpression>
      </textField>

      <textField>
	<reportElement x="420" y="0" width="95" height="13"/>
	<textElement textAlignment="Right"/>
	<textFieldExpression class="java.lang.String">
	  $F{expenseString}
	</textFieldExpression>
      </textField>
    </band>
  </detail>

  <columnFooter>
    <band height="0"/>
  </columnFooter>

  <pageFooter>
    <band height="30">
    	<textField evaluationTime="Auto">
	<reportElement x="0" y="4" width="515" height="13"/>
	<textElement textAlignment="Left">
	  <font size="10"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $V{TotalPages}.equals($V{PAGE_NUMBER}) ? $P{President}+$P{Dashline} : ""
	</textFieldExpression>
      </textField>
      
      <textField evaluationTime="Auto">
	<reportElement x="0" y="4" width="515" height="13"/>
	<textElement textAlignment="Center">
	  <font size="10"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $V{TotalPages}.equals($V{PAGE_NUMBER}) ? $P{Auditor}+$P{Dashline} : ""
	</textFieldExpression>
      </textField>
      
      <textField evaluationTime="Auto">
	<reportElement x="0" y="4" width="515" height="13"/>
	<textElement textAlignment="Right">
	  <font size="10"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $V{TotalPages}.equals($V{PAGE_NUMBER}) ? $P{Treasurer}+$P{Dashline} : ""
	</textFieldExpression>
      </textField>
    
      <textField>
	<reportElement x="0" y="17" width="200" height="13"/>
	<textElement>
	  <font size="10"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $P{DateToday}
	</textFieldExpression>
      </textField>

      <textField>
	<reportElement x="315" y="17" width="200" height="13"/>
	<textElement textAlignment="Right">
	  <font size="10"/>
	</textElement>
	<textFieldExpression class="java.lang.String">
	  $P{Page} + " " + String.valueOf($V{PAGE_NUMBER})
	</textFieldExpression>
      </textField>
    </band>
  </pageFooter>

  <summary>
    <band height="0" />
  </summary>
</jasperReport>
